'use strict';

var createDeferred = require('./createDeferred.js');

function createPromiseTimer(ms) {
    let deferred = createDeferred.createDeferred();
    let timeout = null;
    const timer = {
        get promise () {
            return deferred.promise;
        },
        start,
        reset,
        clear
    };
    return timer;
    function start() {
        if (timeout != null) {
            throw new Error('PromiseTimer already started.');
        }
        timeout = setTimeout(deferred.resolve, ms);
        return timer;
    }
    function reset() {
        clear();
        deferred = createDeferred.createDeferred();
        return timer;
    }
    function clear() {
        if (timeout != null) {
            clearTimeout(timeout);
            timeout = null;
        }
        return timer;
    }
}

exports.createPromiseTimer = createPromiseTimer;
